(function(angular){"use strict";var module=angular.module("countUpModule",[]);module.directive("countUp",["$filter",function($filter){return{restrict:"A",scope:{startVal:"=?",endVal:"=",duration:"=?",decimals:"=?",reanimateOnClick:"=?"},link:function($scope,$el,$attrs){function CountUp(startVal,endVal,decimals,duration){var lastTime=0;var vendors=["webkit","moz","ms","o"];for(var x=0;x<vendors.length&&!window.requestAnimationFrame;++x){window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(callback,element){var currTime=(new Date).getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);lastTime=currTime+timeToCall;return id}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(id){clearTimeout(id)}}this.d=$el[0];this.startVal=startVal;this.endVal=endVal;this.countDown=this.startVal>this.endVal;this.frameVal=this.startVal;this.duration=duration*1e3||2e3;this.decimals=Math.max(0,decimals||0);this.dec=Math.pow(10,this.decimals);var self=this;this.printValue=function(value){var result=$filter("number")(value,decimals);this.d.innerHTML=result};this.easeOutExpo=function(t,b,c,d){return c*(-Math.pow(2,-10*t/d)+1)*1024/1023+b};this.count=function(timestamp){if(!self.startTime)self.startTime=timestamp;self.timestamp=timestamp;var progress=timestamp-self.startTime;self.remaining=self.duration-progress;if(self.countDown){self.frameVal=self.startVal-self.easeOutExpo(progress,0,self.startVal-self.endVal,self.duration)}else{self.frameVal=self.easeOutExpo(progress,self.startVal,self.endVal-self.startVal,self.duration)}if(self.countDown){self.frameVal=self.frameVal<self.endVal?self.endVal:self.frameVal}else{self.frameVal=self.frameVal>self.endVal?self.endVal:self.frameVal}self.frameVal=Math.round(self.frameVal*self.dec)/self.dec;self.printValue(self.frameVal);if(progress<self.duration){self.rAF=requestAnimationFrame(self.count)}else{if(self.callback)self.callback()}};this.start=function(callback){self.callback=callback;if(!isNaN(self.endVal)&&!isNaN(self.startVal)&&self.startVal!==self.endVal){self.rAF=requestAnimationFrame(self.count)}else{this.d.innerHTML=endVal}return false};this.reset=function(){self.paused=false;delete self.startTime;self.startVal=startVal;cancelAnimationFrame(self.rAF);self.printValue(self.startVal)};this.update=function(newEndVal){delete self.callback;cancelAnimationFrame(self.rAF);self.paused=false;delete self.startTime;self.startVal=self.frameVal;self.endVal=Number(newEndVal);self.countDown=self.startVal>self.endVal;self.rAF=requestAnimationFrame(self.count)};self.printValue(self.startVal)}var countUp=createCountUp($scope.startVal,$scope.endVal,$scope.decimals,$scope.duration);function createCountUp(sta,end,dec,dur){sta=sta||0;if(isNaN(sta))sta=Number(sta.match(/[\d\-\.]+/g).join(""));end=end||0;if(isNaN(end))end=Number(end.match(/[\d\-\.]+/g).join(""));dur=Number(dur)||2,dec=Number(dec)||0;var countUp=new CountUp(sta,end,dec,dur);if(end>9999){countUp=new CountUp(sta,end-100,dec,dur/2)}return countUp}function animate(){countUp.reset();if($scope.endVal>9999){countUp.start(function(){countUp.update($scope.endVal)})}else{countUp.start()}}if($attrs.scrollSpyEvent){$scope.$on($attrs.scrollSpyEvent,function(event,data){if(data===$attrs.id){animate()}})}else{animate()}var reanimateOnClick=angular.isDefined($scope.reanimateOnClick)?$scope.reanimateOnClick:true;if(reanimateOnClick){$el.on("click",function(){animate()})}$scope.$watch("endVal",function(newValue,oldValue){if(newValue==null||newValue===oldValue){return}countUp=createCountUp($scope.startVal,$scope.endVal,$scope.decimals,$scope.duration);animate()})}}}])})(angular);